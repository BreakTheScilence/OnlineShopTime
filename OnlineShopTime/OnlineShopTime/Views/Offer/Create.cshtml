@model OnlineShopTime.Models.Offers
@using CloudinaryDotNet

@{
    ViewBag.Title = "Create";
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="container">
        <h2>@Resources.Home.CreateOffer</h2>
        @Html.ValidationSummary(true)
        <div class="jumbotron">
            <div class="row clearfix">
                <div class="col-md-8 column">
                    <form class="form-horizontal" role="form">
                        <div class="form-group">
                            <label for="inputTitle" class="col-sm-2 control-label">@Resources.Home.OfferPageTitleLabel:</label>
                            <div class="col-sm-10">
                                <input type="text" name="Name" maxlength="75" class="form-control" id="inputTitle" placeholder="@Resources.Home.OfferPageTitleLabel" style="max-width: 60%; margin-bottom:15px" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputDescription" class="col-sm-2 control-label">@Resources.Home.OfferPageDescriptionLabel:</label>
                            <div class="col-sm-10">
                                <textarea class="form-control" name="Description" id="inputDescription" placeholder="@Resources.Home.OfferPageDescriptionLabel" style="max-width: 90%; resize: none; height: 160px; margin-bottom: 15px"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputTags" class="col-sm-2 control-label">@Resources.Home.OfferPageTagsLabel:</label>
                            <div class="col-sm-10">
                                <input type="text" name="Tags" class="form-control" id="inputTags" placeholder="@Resources.Home.TagsSeparator" style="max-width: 60%; margin-bottom: 15px" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button type="submit" class="btn btn-default">@Resources.Home.CreateButton</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-4 column">
                    <form>
                       @* @Model.Cloudinary.Api.BuildUploadForm("test-field", "auto", new SortedDictionary<string, object>() { { "tags", (object)"direct_photo_album" } }, new Dictionary<string, string>() { { "multiple", "true" } })*@
                    </form>
                    <div class="progress progress-striped" style="width:70%" id="progress" hidden="hidden">
                        <div class="progress-bar" role="progressbar" style="width: 100%">
                        </div>
                    </div>
                    <br />
                    <div class="uploaded_info_holder" style="max-width: 310px; max-height: 310px; min-width: 310px; min-height: 310px; ">
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

   @* @Model.Cloudinary.GetCloudinaryJsConfig()*@

    <script type="text/javascript">
        $(function () {
            var count = 0;
            $('.cloudinary-fileupload')
            .fileupload({
                dropZone: '#direct_upload',
                start: function () {
                    $('.cloudinary-fileupload').hide();
                    $('#progress').show();
                    $('#progress').addClass('active');
                },
                progress: function () {
                    //do nothing
                },
            })
            .on('cloudinarydone', function (e, data) {
                $('.cloudinary-fileupload').show();
                $('#progress').hide();
                $('#progress').removeClass('active');
                $.post('/Offer/AddImageToOffer', data.result);
                var style = "style=\"float: right; margin-bottom: 10px\"";
                if (count % 2 == 0)
                    style = "style=\"float: left; margin-bottom: 10px\"";
                var info = $('<div class="uploaded_info" ' + style + '/>');
                $(info).append($('<div class="image"/>').append(
                  $.cloudinary.image(data.result.public_id, {
                      format: data.result.format, width: 150, height: 150, crop: "fill"
                  })
                ));
                $('.uploaded_info_holder').append(info);
                count++;
                if (count >= 4) {
                    $('.cloudinary-fileupload').hide();
                    $('#progress').hide();
                }
            });
        });
    </script>
}